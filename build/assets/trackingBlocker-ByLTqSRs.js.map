{"version":3,"file":"trackingBlocker-ByLTqSRs.js","sources":["../../src/core/debug.js","../../src/core/consent.js","../../src/core/trackingBlocker.js"],"sourcesContent":["/**\n * Debug logging utilities for Enspyred Cookie Consent\n * Only logs to console when debug mode is enabled in plugin settings\n */\n\nconst isDebugEnabled = () => {\n  // Check both data sources (banner uses ECC_DATA, optout uses ECC_OPTOUT_DATA)\n  return window.ECC_DATA?.settings?.debug_mode === true ||\n         window.ECC_OPTOUT_DATA?.debug === true;\n};\n\nexport const debugLog = (...args) => {\n  if (isDebugEnabled()) {\n    console.log('[Cookie Consent]', ...args);\n  }\n};\n\nexport const debugError = (...args) => {\n  if (isDebugEnabled()) {\n    console.error('[Cookie Consent]', ...args);\n  }\n};\n","// Consent Manager - Handles localStorage for cookie consent choices\nimport { debugLog, debugError } from \"./debug\";\n\nconst STORAGE_KEY = \"enspyred_cookie_consent\";\nconst EXPIRY_MONTHS = 12;\n\n/**\n * Get current consent status\n * @returns {Object|null} Consent object or null if not set\n */\nexport const getConsent = () => {\n    try {\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (!stored) return null;\n\n        const consent = JSON.parse(stored);\n\n        // Check if expired\n        if (consent.expiresAt && Date.now() > consent.expiresAt) {\n            clearConsent();\n            return null;\n        }\n\n        return consent;\n    } catch (error) {\n        debugError(\"Error reading consent:\", error);\n        return null;\n    }\n};\n\n/**\n * Set consent choice\n * @param {string} choice - 'accepted', 'opted-out', or 'dismissed'\n */\nexport const setConsent = (choice) => {\n    try {\n        const now = Date.now();\n        const expiresAt = now + EXPIRY_MONTHS * 30 * 24 * 60 * 60 * 1000; // ~12 months\n\n        const consent = {\n            choice,\n            timestamp: now,\n            expiresAt,\n        };\n\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(consent));\n        debugLog(\"Choice saved:\", choice);\n    } catch (error) {\n        debugError(\"Error saving consent:\", error);\n    }\n};\n\n/**\n * Check if user has made a valid consent choice\n * @returns {boolean}\n */\nexport const hasValidConsent = () => {\n    const consent = getConsent();\n    return consent !== null;\n};\n\n/**\n * Check if user opted out\n * @returns {boolean}\n */\nexport const isOptedOut = () => {\n    const consent = getConsent();\n    return consent?.choice === \"opted-out\";\n};\n\n/**\n * Clear consent (for testing/reset)\n */\nexport const clearConsent = () => {\n    try {\n        localStorage.removeItem(STORAGE_KEY);\n        debugLog(\"Consent cleared\");\n    } catch (error) {\n        debugError(\"Error clearing consent:\", error);\n    }\n};\n","// Tracking Blocker - Disables Google Analytics, Google Ads, and Microsoft Clarity\n// SAFE APPROACH: No monkey-patching of third-party globals\nimport { debugLog } from \"./debug\";\n\n/**\n * Block all tracking scripts\n */\nexport const blockAll = () => {\n    debugLog('Blocking all tracking scripts...');\n\n    blockGoogleAnalytics();\n    blockGoogleAds();\n    blockMicrosoftClarity();\n\n    debugLog('All tracking scripts blocked');\n};\n\n/**\n * Block Google Analytics using official disable flags\n * (No monkey-patching of window.ga)\n */\nconst blockGoogleAnalytics = () => {\n    // Delete GA cookies first\n    deleteGACookies();\n\n    // Use official GA disable flags (supported by Google)\n    window['ga-disable'] = true;\n\n    // Find and disable specific GA4 measurement IDs\n    if (window.gtag && window.dataLayer) {\n        const dataLayer = window.dataLayer || [];\n\n        dataLayer.forEach(item => {\n            if (Array.isArray(item) && item[0] === 'config' && typeof item[1] === 'string') {\n                const measurementId = item[1];\n                if (measurementId.startsWith('G-') || measurementId.startsWith('UA-')) {\n                    window[`ga-disable-${measurementId}`] = true;\n                    debugLog('GA disabled for:', measurementId);\n                }\n            }\n        });\n    }\n\n    // Generic GA4 pattern disable\n    window['ga-disable-G-'] = true;\n\n    debugLog('Google Analytics blocked (using official disable flags)');\n};\n\n/**\n * Delete Google Analytics cookies\n */\nconst deleteGACookies = () => {\n    const gaCookies = ['_ga', '_gid', '_gat', '_gat_gtag', '_gac_gb'];\n    deleteCookies(gaCookies);\n    debugLog('GA cookies deleted');\n};\n\n/**\n * Block Google Ads conversion tracking\n */\nconst blockGoogleAds = () => {\n    if (window.gtag) {\n        // Disable data collection (official gtag API)\n        window.gtag('set', 'ads_data_redaction', true);\n        window.gtag('set', 'allow_ad_personalization_signals', false);\n\n        // Find and disable Google Ads accounts in dataLayer\n        if (window.dataLayer) {\n            window.dataLayer.forEach(item => {\n                if (Array.isArray(item) && item[0] === 'config' &&\n                    typeof item[1] === 'string' && item[1].startsWith('AW-')) {\n                    window.gtag('config', item[1], {\n                        'send_page_view': false,\n                        'allow_google_signals': false,\n                        'allow_ad_personalization_signals': false\n                    });\n                    debugLog('Google Ads disabled for:', item[1]);\n                }\n            });\n        }\n\n        debugLog('Google Ads blocked');\n    }\n};\n\n/**\n * Block Microsoft Clarity\n * SAFE APPROACH: Remove script tags, do NOT monkey-patch window.clarity\n */\nconst blockMicrosoftClarity = () => {\n    // Remove any existing Clarity scripts from DOM\n    const clarityScripts = document.querySelectorAll('script[src*=\"clarity.ms\"]');\n    clarityScripts.forEach(script => {\n        script.remove();\n        debugLog('Clarity script removed from DOM');\n    });\n\n    // Remove inline Clarity initialization scripts\n    document.querySelectorAll('script:not([src])').forEach(script => {\n        const content = script.textContent || '';\n        if (content.includes('clarity.ms') ||\n            (content.includes('window.clarity') && content.includes('function'))) {\n            script.remove();\n            debugLog('Clarity inline script removed');\n        }\n    });\n\n    // Delete Clarity cookies\n    const clarityCookies = ['_clck', '_clsk', 'CLID', 'ANONCHK', 'MR', 'MUID', 'SM'];\n    deleteCookies(clarityCookies);\n\n    debugLog('Clarity blocked (scripts removed, cookies deleted)');\n\n    // NOTE: We intentionally do NOT do this anymore:\n    // window.clarity = function() {};  // <-- CAUSES MIME ERROR\n};\n\n/**\n * Helper to delete cookies with multiple domain/path combinations\n */\nconst deleteCookies = (names) => {\n    const hostname = window.location.hostname;\n    names.forEach(cookieName => {\n        document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\n        document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=${hostname};`;\n        document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.${hostname};`;\n    });\n};\n"],"names":["isDebugEnabled","_a","_b","_c","debugLog","args","debugError","STORAGE_KEY","getConsent","stored","consent","clearConsent","error","setConsent","choice","now","expiresAt","hasValidConsent","isOptedOut","blockAll","blockGoogleAnalytics","blockGoogleAds","blockMicrosoftClarity","deleteGACookies","item","measurementId","deleteCookies","script","content","names","hostname","cookieName"],"mappings":"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"}