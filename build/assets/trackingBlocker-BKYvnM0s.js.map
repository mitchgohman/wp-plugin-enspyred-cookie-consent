{"version":3,"file":"trackingBlocker-BKYvnM0s.js","sources":["../../src/core/debug.js","../../src/core/consent.js","../../src/core/trackingBlocker.js"],"sourcesContent":["/**\n * Debug logging utilities for Enspyred Cookie Consent\n * Only logs to console when debug mode is enabled in plugin settings\n */\n\nconst isDebugEnabled = () => {\n  // Check both data sources (banner uses ECC_DATA, optout uses ECC_OPTOUT_DATA)\n  return window.ECC_DATA?.settings?.debug_mode === true ||\n         window.ECC_OPTOUT_DATA?.debug === true;\n};\n\nexport const debugLog = (...args) => {\n  if (isDebugEnabled()) {\n    console.log('[Cookie Consent]', ...args);\n  }\n};\n\nexport const debugError = (...args) => {\n  if (isDebugEnabled()) {\n    console.error('[Cookie Consent]', ...args);\n  }\n};\n","// Consent Manager - Handles localStorage for cookie consent choices\nimport { debugLog, debugError } from \"./debug\";\n\nconst STORAGE_KEY = \"enspyred_cookie_consent\";\nconst EXPIRY_MONTHS = 12;\n\n/**\n * Get current consent status\n * @returns {Object|null} Consent object or null if not set\n */\nexport const getConsent = () => {\n    try {\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (!stored) return null;\n\n        const consent = JSON.parse(stored);\n\n        // Check if expired\n        if (consent.expiresAt && Date.now() > consent.expiresAt) {\n            clearConsent();\n            return null;\n        }\n\n        return consent;\n    } catch (error) {\n        debugError(\"Error reading consent:\", error);\n        return null;\n    }\n};\n\n/**\n * Set consent choice\n * @param {string} choice - 'accepted', 'opted-out', or 'dismissed'\n */\nexport const setConsent = (choice) => {\n    try {\n        const now = Date.now();\n        const expiresAt = now + EXPIRY_MONTHS * 30 * 24 * 60 * 60 * 1000; // ~12 months\n\n        const consent = {\n            choice,\n            timestamp: now,\n            expiresAt,\n        };\n\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(consent));\n        debugLog(\"Choice saved:\", choice);\n    } catch (error) {\n        debugError(\"Error saving consent:\", error);\n    }\n};\n\n/**\n * Check if user has made a valid consent choice\n * @returns {boolean}\n */\nexport const hasValidConsent = () => {\n    const consent = getConsent();\n    return consent !== null;\n};\n\n/**\n * Check if user opted out\n * @returns {boolean}\n */\nexport const isOptedOut = () => {\n    const consent = getConsent();\n    return consent?.choice === \"opted-out\";\n};\n\n/**\n * Clear consent (for testing/reset)\n */\nexport const clearConsent = () => {\n    try {\n        localStorage.removeItem(STORAGE_KEY);\n        debugLog(\"Consent cleared\");\n    } catch (error) {\n        debugError(\"Error clearing consent:\", error);\n    }\n};\n","// Tracking Blocker - Disables Google Analytics, Google Ads, and Microsoft Clarity\nimport { debugLog } from \"./debug\";\n\n/**\n * Block all tracking scripts\n */\nexport const blockAll = () => {\n    debugLog('Blocking all tracking scripts...');\n\n    blockGoogleAnalytics();\n    blockGoogleAds();\n    blockMicrosoftClarity();\n\n    debugLog('All tracking scripts blocked');\n};\n\n/**\n * Block Google Analytics\n */\nconst blockGoogleAnalytics = () => {\n    // Delete GA cookies\n    deleteGACookies();\n\n    // Disable GA globally\n    if (window.gtag) {\n        // Find GA measurement ID from dataLayer\n        const dataLayer = window.dataLayer || [];\n        const gaConfig = dataLayer.find(item =>\n            Array.isArray(item) && item[0] === 'config' && item[1]?.startsWith('G-')\n        );\n\n        if (gaConfig && gaConfig[1]) {\n            const measurementId = gaConfig[1];\n            window[`ga-disable-${measurementId}`] = true;\n            debugLog('GA disabled for:', measurementId);\n        }\n\n        // Generic disable\n        window['ga-disable'] = true;\n    }\n\n    // Disable classic GA\n    if (window.ga) {\n        window.ga = function() {};\n    }\n};\n\n/**\n * Delete Google Analytics cookies\n */\nconst deleteGACookies = () => {\n    const gaCookies = ['_ga', '_gid', '_gat', '_gat_gtag'];\n\n    gaCookies.forEach(cookieName => {\n        // Delete for current domain\n        document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\n\n        // Delete for parent domain\n        const domain = window.location.hostname;\n        document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=${domain};`;\n        document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=.${domain};`;\n    });\n\n    debugLog('GA cookies deleted');\n};\n\n/**\n * Block Google Ads\n */\nconst blockGoogleAds = () => {\n    if (window.gtag) {\n        // Disable conversion tracking\n        window.gtag('set', 'ads_data_redaction', true);\n        window.gtag('set', 'allow_ad_personalization_signals', false);\n\n        // Disable specific Google Ads account (AW-1050709691)\n        window.gtag('config', 'AW-1050709691', {\n            'send_page_view': false,\n            'allow_google_signals': false,\n            'allow_ad_personalization_signals': false\n        });\n\n        debugLog('Google Ads blocked');\n    }\n};\n\n/**\n * Block Microsoft Clarity\n */\nconst blockMicrosoftClarity = () => {\n    // Remove Clarity script if present\n    const clarityScripts = document.querySelectorAll('script[src*=\"clarity.ms\"]');\n    clarityScripts.forEach(script => {\n        script.remove();\n        debugLog('Clarity script removed');\n    });\n\n    // Disable Clarity if loaded\n    if (window.clarity) {\n        window.clarity = function() {};\n        debugLog('Clarity function disabled');\n    }\n\n    // Delete Clarity cookies\n    const clarityCookies = ['_clck', '_clsk', 'CLID', 'ANONCHK', 'MR', 'MUID', 'SM'];\n    clarityCookies.forEach(cookieName => {\n        document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\n    });\n\n    debugLog('Clarity blocked and cookies deleted');\n};\n"],"names":["isDebugEnabled","_a","_b","_c","debugLog","args","debugError","STORAGE_KEY","getConsent","stored","consent","clearConsent","error","setConsent","choice","now","expiresAt","hasValidConsent","isOptedOut","blockAll","blockGoogleAnalytics","blockGoogleAds","blockMicrosoftClarity","deleteGACookies","gaConfig","item","measurementId","cookieName","domain","script"],"mappings":"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"}